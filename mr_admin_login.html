<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EliteMart BD - Admin Dashboard</title>
    <script>
        // Admin security - check login
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'admin-login.html';
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gold);
        }

        .admin-header h1 {
            color: var(--gold);
            margin: 0;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid #222;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            color: var(--muted);
            margin: 0 0 10px 0;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .admin-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: #0f0f0f;
            border: 2px solid #222;
            color: var(--muted);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-btn.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .filter-btn:hover {
            border-color: var(--gold);
        }

        .orders-table {
            background: var(--card);
            border: 1px solid #222;
            border-radius: 10px;
            overflow: hidden;
        }

        .table-header {
            display: grid;
            grid-template-columns: 100px 180px 200px 120px 150px 100px 150px;
            gap: 15px;
            padding: 20px;
            background: #0f0f0f;
            border-bottom: 2px solid #333;
            font-weight: 700;
            color: var(--gold);
            font-size: 0.9rem;
        }

        .table-row {
            display: grid;
            grid-template-columns: 100px 180px 200px 120px 150px 100px 150px;
            gap: 15px;
            padding: 18px 20px;
            border-bottom: 1px solid #333;
            align-items: center;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row:hover {
            background: #0f0f0f;
        }

        .order-id {
            color: var(--gold);
            font-weight: 700;
            font-size: 0.9rem;
        }

        .customer-name {
            color: #fff;
            font-size: 0.9rem;
        }

        .customer-phone {
            color: var(--muted);
            font-size: 0.85rem;
        }

        .order-date {
            color: var(--muted);
            font-size: 0.85rem;
        }

        .order-items {
            color: var(--muted);
            font-size: 0.85rem;
        }

        .order-total {
            color: #fff;
            font-weight: 700;
        }

        .status-badge {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }

        .status-pending {
            background: #3d3d0b;
            color: #ffff99;
        }

        .status-confirmed {
            background: #0b3d0b;
            color: #adffad;
        }

        .status-shipped {
            background: #0b2d3d;
            color: #99ddff;
        }

        .status-delivered {
            background: #0b3d0b;
            color: #adffad;
        }

        .status-cancelled {
            background: #3d0b0b;
            color: #ff9999;
        }

        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 10px;
            font-size: 0.75rem;
            border: 1px solid #333;
            background: #0f0f0f;
            color: var(--gold);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .order-detail-modal {
            background: var(--card);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }

        .modal-header h2 {
            color: var(--gold);
            margin: 0;
        }

        .modal-close {
            font-size: 28px;
            color: var(--gold);
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            transform: scale(1.2);
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-section h3 {
            color: var(--gold);
            margin: 0 0 15px 0;
            font-size: 1rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .detail-item {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-label {
            color: var(--muted);
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .items-list {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #333;
            font-size: 0.9rem;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-name {
            color: #fff;
            flex: 1;
        }

        .item-qty {
            color: var(--muted);
            margin: 0 15px;
        }

        .item-price {
            color: var(--gold);
            font-weight: 700;
        }

        .status-update {
            margin-top: 25px;
        }

        .status-select {
            width: 100%;
            padding: 12px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .status-select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .update-status-btn {
            width: 100%;
            padding: 12px;
            background: var(--gold);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .update-status-btn:hover {
            background: #e8c355;
        }

        .delete-order-btn {
            width: 100%;
            padding: 12px;
            background: #3d0b0b;
            color: #ff9999;
            border: 1px solid #663333;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .delete-order-btn:hover {
            background: #5a1515;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state h2 {
            color: var(--gold);
            margin-bottom: 15px;
        }

        @media (max-width: 1200px) {
            .table-header,
            .table-row {
                grid-template-columns: 80px 150px auto 100px 120px 100px;
                gap: 10px;
                padding: 12px 15px;
            }
        }

        @media (max-width: 900px) {
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .table-header,
            .table-row {
                grid-template-columns: 80px 140px 1fr 100px;
                gap: 8px;
            }

            .order-date,
            .order-items {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <div class="mark">EM</div>
            <div>
                <h1>EliteMart BD</h1>
                <div style="color:var(--muted);font-size:0.9rem">Style that Speaks, Quality that Lasts</div>
            </div>
        </a>

        <div class="searchbar">
            <input placeholder="Search orders..." />
            <button class="searchbtn" onclick="searchOrders()">Search</button>
        </div>

        <!-- Hero Management Panel -->
        <div id="heroPanel" style="background: linear-gradient(135deg, #0f0f0f, #0b0b0b); border: 1px solid #222; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <h2 style="color:var(--gold); margin:0">üåü Hero / Carousel Manager</h2>
                <div style="display:flex; gap:8px;">
                    <button onclick="openAddHeroModal()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add New Hero</button>
                    <button onclick="toggleAddHeroInline()" id="inlineHeroBtn" style="background: #0066cc; color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Inline Add</button>
                </div>
            </div>
            <div id="heroList" style="display:grid; gap:10px;"></div>
            <div id="heroEmpty" style="display:none; color:#bbb;">No hero items yet.</div>
                
                <!-- Inline Add Hero Area (hidden by default) -->
                <div id="addHeroInline" style="display:none; margin-top:12px; padding:12px; border:1px dashed #333; border-radius:8px; background:#0b0b0b;">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:start;">
                        <div>
                            <label style="color:var(--gold); font-weight:600; display:block; margin-bottom:6px;">Title</label>
                            <input id="inlineHeroTitle" type="text" placeholder="Hero title" style="width:100%; padding:10px; background:#111; border:1px solid #333; color:#fff; border-radius:6px;" />
                            <label style="color:var(--gold); font-weight:600; display:block; margin:10px 0 6px;">Subtitle</label>
                            <textarea id="inlineHeroSubtitle" placeholder="Short subtitle" style="width:100%; padding:10px; background:#111; border:1px solid #333; color:#fff; border-radius:6px; min-height:80px;"></textarea>
                            <label style="color:var(--gold); font-weight:600; display:block; margin:10px 0 6px;">CTA Text</label>
                            <input id="inlineHeroCtaText" type="text" placeholder="Shop Now" style="width:100%; padding:10px; background:#111; border:1px solid #333; color:#fff; border-radius:6px;" />
                            <label style="color:var(--gold); font-weight:600; display:block; margin:10px 0 6px;">CTA Link</label>
                            <input id="inlineHeroCtaLink" type="text" placeholder="index.html" style="width:100%; padding:10px; background:#111; border:1px solid #333; color:#fff; border-radius:6px;" />
                            <label style="display:flex; align-items:center; gap:8px; margin-top:8px; color:var(--muted);"><input type="checkbox" id="inlineHeroActive" checked /> Active</label>
                        </div>
                        <div>
                            <label style="color:var(--gold); font-weight:600; display:block; margin-bottom:6px;">Image</label>
                            <input id="inlineHeroImageFile" type="file" accept="image/*" />
                            <div id="inlineHeroDropZone" style="margin-top:10px; padding:12px; border:2px dashed #333; border-radius:8px; color:#bbb;">Drag & drop an image here or use the file input</div>
                            <div id="inlineHeroPreview" style="margin-top:10px; width:100%; height:160px; background:#111; border-radius:6px; display:flex; align-items:center; justify-content:center; overflow:hidden; border:1px solid #222;"></div>
                            <div style="display:flex; gap:8px; margin-top:10px;">
                                <button onclick="addHeroFromInlineForm()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">Save</button>
                                <button onclick="closeAddHeroInline()" style="background:#666;color:#fff;border:none;padding:8px 14px;border-radius:8px;">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        <!-- Announcement Manager removed -->

        <div class="toplinks">
            <div class="badge">üîê Admin Panel</div>
            <a class="badge" href="index.html">‚Üê Back to Shop</a>
        </div>
    </header>

    <div class="admin-container">
        <div id="adminAlert" class="admin-alert" role="status" aria-live="polite" style="display:none;"></div>
        <div class="admin-header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h1>üìä Order Management Dashboard</h1>
                <button onclick="logout()" style="background: #8b0000; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#b80000'" onmouseout="this.style.background='#8b0000'">üö™ Logout</button>
            </div>
            <div style="color: var(--muted); font-size: 0.9rem;">Total Orders: <strong style="color: var(--gold);" id="totalOrders">0</strong></div>
        </div>

        <!-- Statistics -->
        <div class="admin-stats">
            <div class="stat-card">
                <h3>üì¶ Total Orders</h3>
                <div class="value" id="statTotal">0</div>
            </div>
            <div class="stat-card">
                <h3>‚è≥ Pending</h3>
                <div class="value" id="statPending">0</div>
            </div>
            <div class="stat-card">
                <h3>‚úÖ Confirmed</h3>
                <div class="value" id="statConfirmed">0</div>
            </div>
            <div class="stat-card">
                <h3>üì§ Shipped</h3>
                <div class="value" id="statShipped">0</div>
            </div>
            <div class="stat-card">
                <h3>üöö Delivered</h3>
                <div class="value" id="statDelivered">0</div>
            </div>
            <div class="stat-card">
                <h3>üí∞ Total Revenue</h3>
                <div class="value" id="statRevenue">‡ß≥0</div>
            </div>
        </div>

        <!-- Add Product / Customers Section Toggle -->
        <div style="margin-bottom: 30px; display: flex; gap: 10px; flex-wrap:wrap;">
            <button onclick="toggleAddProductForm()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">‚úö Add New Product</button>
            <button onclick="toggleCustomersPanel()" style="background: linear-gradient(135deg, #4a76ff, #2a5cff); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease;">üë• View Customers</button>
        </div>

        <!-- Add Product Form (Hidden by default) -->
        <div id="addProductForm" style="display: none; background: linear-gradient(135deg, #1a1a1a, #0f0f0f); border: 2px solid var(--gold); padding: 30px; border-radius: 10px; margin-bottom: 30px;">
            <h2 style="color: var(--gold); margin-top: 0;">‚ûï Add New Product</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Product Name *</label>
                    <input id="productName" type="text" placeholder="Enter product name" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Category *</label>
                    <select id="productCategory" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                        <option value="">Select Category</option>
                        <option value="fashion">Fashion</option>
                        <option value="men">Men</option>
                        <option value="women">Women</option>
                        <option value="accessories">Accessories</option>
                        <option value="gadgets">Gadgets</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Price (‡ß≥) *</label>
                    <input id="productPrice" type="number" placeholder="Enter price" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Original Price (‡ß≥)</label>
                    <input id="productOriginal" type="number" placeholder="Original price (for discount)" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Rating (0-5) *</label>
                    <input id="productRating" type="number" step="0.1" min="0" max="5" placeholder="e.g., 4.5" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Sizes (comma separated)</label>
                    <input id="productSizes" type="text" placeholder="e.g., S,M,L,XL or One Size" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Primary Image URL *</label>
                    <input id="productImage" type="text" placeholder="Enter primary image URL" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
                </div>
            </div>
            <div style="margin-top: 20px;">
                <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Additional Images (one URL per line, optional)</label>
                <textarea id="productImages" placeholder="Image URL 1&#10;Image URL 2&#10;Image URL 3" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins; resize: vertical; min-height: 80px;"></textarea>
            </div>
            <div style="margin-top: 20px;">
                <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Video URL (YouTube embed link, optional)</label>
                <input id="productVideo" type="text" placeholder="e.g., https://www.youtube.com/embed/..." style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins;">
            </div>
            <div style="margin-top: 20px;">
                <label style="display: block; color: var(--gold); margin-bottom: 8px; font-weight: 600;">Description *</label>
                <textarea id="productDescription" placeholder="Enter product description" style="width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Poppins; resize: vertical; min-height: 100px;"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="addNewProduct()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">‚úì Add Product</button>
                <button onclick="toggleAddProductForm()" style="background: #666; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#888'" onmouseout="this.style.background='#666'">‚úï Cancel</button>
            </div>
        </div>

        <!-- Products Management Panel -->
        <div id="productsPanel" style="background: linear-gradient(135deg, #0f0f0f, #0b0b0b); border: 1px solid #222; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color:var(--gold); margin:0">üì¶ Products Inventory</h2>
                <input type="text" id="productSearch" placeholder="Search products..." style="padding: 8px 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; width: 250px;">
            </div>
            <div id="productsList" style="display:grid; gap:10px;"></div>
            <div id="productsEmpty" style="display:none; color:#bbb;">No products yet.</div>
        </div>

        <!-- Categories Management Panel -->
        <div id="categoriesPanel" style="background: linear-gradient(135deg, #0f0f0f, #0b0b0b); border: 1px solid #222; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <h2 style="color:var(--gold); margin:0">üè∑Ô∏è Categories Manager</h2>
                <div style="display:flex; gap:8px;">
                    <button onclick="openAddCategoryInput()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add Category</button>
                </div>
            </div>

            <div id="addCategoryArea" style="display:none; margin-bottom:12px;">
                <input id="newCategoryName" type="text" placeholder="Category name" style="padding:10px; width:40%; background:#111; border:1px solid #333; color:#fff; border-radius:6px;" />
                <input id="newCategoryImageFile" type="file" accept="image/*" style="margin-left:10px;" />
                <button onclick="addCategoryFromForm()" style="margin-left:8px; padding:8px 12px; background:var(--gold); border:none; color:#000; border-radius:6px; font-weight:700;">Save</button>
                <button onclick="closeAddCategoryInput()" style="margin-left:6px; padding:8px 12px; background:#666; border:none; color:#fff; border-radius:6px;">Cancel</button>
                <div id="categoryDropZone" style="margin-top:10px; padding:12px; border:2px dashed #333; border-radius:8px; color:#bbb;">Drag & drop an image here or use the file input</div>
            </div>

            <div id="categoriesList" style="display:grid; gap:10px;"></div>
            <div id="categoriesEmpty" style="display:none; color:#bbb;">No categories yet. Click "Add Category" to create one.</div>
        </div>

        <!-- Customers Panel (Hidden by default) -->
        <div id="customersPanel" style="display:none; background: linear-gradient(135deg, #0f0f0f, #0b0b0b); border: 1px solid #222; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <h2 style="color:var(--gold); margin-top:0">üë• Registered Customers</h2>
            <div id="customersList" style="display:grid; gap:10px;"></div>
            <div id="customersEmpty" style="display:none; color:#bbb;">No registered customers yet.</div>
        </div>

        <!-- Filters -->
        <div class="admin-filters">
            <button class="filter-btn active" onclick="filterOrders('all')">All Orders</button>
            <button class="filter-btn" onclick="filterOrders('pending')">Pending</button>
            <button class="filter-btn" onclick="filterOrders('confirmed')">Confirmed</button>
            <button class="filter-btn" onclick="filterOrders('shipped')">Shipped</button>
            <button class="filter-btn" onclick="filterOrders('delivered')">Delivered</button>
            <button class="filter-btn" onclick="filterOrders('cancelled')">Cancelled</button>
        </div>

        <!-- Orders Table -->
        <div class="orders-table">
            <div class="table-header">
                <div>Order ID</div>
                <div>Customer</div>
                <div>Address</div>
                <div>Date</div>
                <div>Items</div>
                <div>Total</div>
                <div>Status</div>
                <div style="text-align: center;">Action</div>
            </div>
            <div id="ordersTableBody"></div>
        </div>
    </div>

    <script src="toast.js"></script>
    <script>
        // initialize hero manager list
        try { renderHeroList(); } catch(e) { console.warn('Hero render failed', e); }
    </script>

    <!-- Order Detail Modal -->
    <!-- Edit Product Modal -->
    <div id="editProductModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 2000; padding: 20px; overflow-y: auto;">
        <div style="background: white; max-width: 700px; margin: 40px auto; padding: 20px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <h2 style="color: #333; margin-top: 0; margin-bottom: 18px;">‚úèÔ∏è Edit Product</h2>

            <input id="editProductId" type="hidden">

            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Product Name *</label>
                <input id="editProductName" type="text" placeholder="Product name" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 12px;">
                <div>
                    <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Category *</label>
                    <select id="editProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
                        <option value="">Select category</option>
                        <option value="gadgets">Gadgets</option>
                        <option value="fashion">Fashion</option>
                        <option value="accessories">Accessories</option>
                        <option value="men">Men</option>
                        <option value="women">Women</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Rating (0-5) *</label>
                    <input id="editProductRating" type="number" step="0.1" min="0" max="5" placeholder="Rating" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 12px;">
                <div>
                    <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Price (‡ß≥) *</label>
                    <input id="editProductPrice" type="number" placeholder="Selling price" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
                </div>
                <div>
                    <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Original Price (‡ß≥)</label>
                    <input id="editProductOriginal" type="number" placeholder="Original price" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
                </div>
            </div>

            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Sizes (comma separated)</label>
                <input id="editProductSizes" type="text" placeholder="e.g., S,M,L,XL" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
            </div>

            <div style="margin-bottom: 12px;">
                <label style="display:block; color:#555; margin-bottom:6px; font-weight:600;">Primary Image URL</label>
                <input id="editProductImage" type="text" placeholder="Enter image URL or use file upload" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                    <input id="editProductImageFile" type="file" accept="image/*" />
                    <button type="button" onclick="clearEditImageFile()" style="background:#666;color:#fff;border:none;padding:8px 10px;border-radius:6px;">Clear File</button>
                </div>
                <div id="editProductPreview" style="margin-top:10px; width:100%; height:140px; background:#f6f6f6; border-radius:6px; overflow:hidden; display:flex; align-items:center; justify-content:center; border:1px solid #ddd;">
                    <span style="color:#666;">No image preview</span>
                </div>
            </div>

            <div style="margin-bottom: 12px;">
                <label style="display:block; color:#555; margin-bottom:6px; font-weight:600;">Additional Image URLs (one per line)</label>
                <textarea id="editProductImages" placeholder="https://...\nhttps://..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; min-height:80px;"></textarea>
            </div>

            <!-- Product Colors Section -->
            <div style="margin-bottom: 12px; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                <label style="display: block; color: #555; margin-bottom: 10px; font-weight: 600;">üé® Product Colors</label>
                <div id="editProductColorsList" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;"></div>
                <button type="button" onclick="addColorField()" style="background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">+ Add Color</button>
            </div>

            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Description *</label>
                <textarea id="editProductDescription" placeholder="Product description" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins; resize: vertical; min-height: 100px;"></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 12px;">
                <div>
                    <label style="display: block; color: #555; margin-bottom: 6px; font-weight: 600;">Sales Count</label>
                    <input id="editProductSales" type="number" min="0" placeholder="Total sales" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Poppins;">
                </div>
                <div style="display: flex; align-items: flex-end;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: #555; font-weight: 600;">
                        <input id="editProductFeatured" type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        ‚≠ê Featured Product (Highlighted)
                    </label>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button onclick="saveProductChanges()" style="background: #28a745; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: 600; flex: 1;">
                    ‚úì Save Changes
                </button>
                <button onclick="closeEditProductModal()" style="background: #666; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: 600; flex: 1;">
                    ‚úï Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Edit / Add Hero Modal -->
    <div id="editHeroModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2100; padding:20px; overflow-y:auto;">
        <div style="background: white; max-width:700px; margin:50px auto; padding:24px; border-radius:12px;">
            <h2 style="margin-top:0; color:#333;">‚ûï Add / Edit Hero Item</h2>
            <input id="heroId" type="hidden">
            <div style="margin-bottom:12px;"><label style="display:block;color:#555;margin-bottom:6px;font-weight:600;">Title</label><input id="heroTitle" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;" /></div>
            <div style="margin-bottom:12px;"><label style="display:block;color:#555;margin-bottom:6px;font-weight:600;">Subtitle</label><textarea id="heroSubtitle" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;min-height:80px;"></textarea></div>
            <div style="margin-bottom:12px;"><label style="display:block;color:#555;margin-bottom:6px;font-weight:600;">Image URL</label><input id="heroImage" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;" /></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                <div><label style="display:block;color:#555;margin-bottom:6px;font-weight:600;">CTA Text</label><input id="heroCtaText" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;" /></div>
                <div><label style="display:block;color:#555;margin-bottom:6px;font-weight:600;">CTA Link</label><input id="heroCtaLink" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;" /></div>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center;"><label style="display:flex;align-items:center;gap:8px;"><input id="heroActive" type="checkbox" /> <span style="color:#555;font-weight:600;">Active</span></label></div>
            <div style="margin-top:18px;display:flex;gap:10px;">
                <button onclick="saveHeroChanges()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 10px 16px; border-radius:6px; font-weight:700;">Save</button>
                <button onclick="closeEditHeroModal()" style="background:#666;color:#fff;border:none;padding:10px 16px;border-radius:6px;">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="orderModal">
        <div class="order-detail-modal">
            <div class="modal-header">
                <h2 id="modalOrderId">Order Details</h2>
                <span class="modal-close" onclick="closeOrderModal()">&times;</span>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <footer>
        ¬© 2025 EliteMart BD Admin ‚Ä¢ Secure Order Management System
    </footer>

    <script src="script.js"></script>
    <script>
        let currentFilter = 'all';

        function getAdminOrders() {
            return JSON.parse(localStorage.getItem('orders')) || [];
        }

        function renderAdminOrders(status = 'all') {
            const orders = getAdminOrders();
            const tableBody = document.getElementById('ordersTableBody');

            let filtered = orders;
            if (status !== 'all') {
                filtered = orders.filter(o => o.status.toLowerCase() === status);
            }

            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filtered.length === 0) {
                tableBody.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><h2>No orders found</h2><p style="color: var(--muted);">No orders match your filter criteria.</p></div>';
                return;
            }

            tableBody.innerHTML = filtered.map(order => `
                <div class="table-row">
                    <div class="order-id">${order.id}</div>
                    <div>
                        <div class="customer-name">${order.customer.firstName} ${order.customer.lastName}</div>
                        <div class="customer-phone">${order.customer.phone}</div>
                    </div>
                    <div>
                        <div class="small" style="color: #fff;">${order.customer.address}</div>
                        <div class="small">${order.customer.city}, ${order.customer.postalCode}</div>
                    </div>
                    <div class="order-date">${order.date}</div>
                    <div class="order-items">${order.items.length} item(s)</div>
                    <div class="order-total">‡ß≥${order.total.toLocaleString()}</div>
                    <div>
                        <div class="status-badge status-${order.status.toLowerCase()}">${order.status}</div>
                    </div>
                    <div class="action-btns" style="justify-content: center;">
                        <button class="action-btn" onclick="viewOrderDetails('${order.id}')">üëÅÔ∏è View</button>
                        <button class="action-btn" onclick="window.open('invoice.html?id=${order.id}', '_blank')" style="background: var(--gold); color: #000; border-color: var(--gold);">üìÑ Invoice</button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const orders = getAdminOrders();
            const statTotal = orders.length;
            const statPending = orders.filter(o => o.status === 'Pending').length;
            const statConfirmed = orders.filter(o => o.status === 'Confirmed').length;
            const statShipped = orders.filter(o => o.status === 'Shipped').length;
            const statDelivered = orders.filter(o => o.status === 'Delivered').length;
            const statRevenue = orders.reduce((sum, o) => sum + o.total, 0);

            document.getElementById('statTotal').textContent = statTotal;
            document.getElementById('statPending').textContent = statPending;
            document.getElementById('statConfirmed').textContent = statConfirmed;
            document.getElementById('statShipped').textContent = statShipped;
            document.getElementById('statDelivered').textContent = statDelivered;
            document.getElementById('statRevenue').textContent = '‡ß≥' + statRevenue.toLocaleString();
            document.getElementById('totalOrders').textContent = statTotal;
        }

        function filterOrders(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderAdminOrders(status);
        }

        function viewOrderDetails(orderId) {
            const orders = getAdminOrders();
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modal = document.getElementById('orderModal');
            const content = document.getElementById('modalContent');

            document.getElementById('modalOrderId').textContent = `Order: ${order.id}`;

            content.innerHTML = `
                <div class="detail-section">
                    <h3>üìã Order Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Order Status</div>
                            <div class="detail-value">
                                <span class="status-badge status-${order.status.toLowerCase()}" style="display: inline-block;">${order.status}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Order Date</div>
                            <div class="detail-value">${order.date}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Payment Method</div>
                            <div class="detail-value">${getPaymentLabel(order.payment)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Amount</div>
                            <div class="detail-value" style="color: var(--gold); font-size: 1.2rem;">‡ß≥${order.total.toLocaleString()}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üë§ Customer Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Name</div>
                            <div class="detail-value">${order.customer.firstName} ${order.customer.lastName}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value">${order.customer.phone}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${order.customer.email}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">City</div>
                            <div class="detail-value">${order.customer.city}</div>
                        </div>
                    </div>
                    <div class="detail-item" style="margin-top: 15px;">
                        <div class="detail-label">Shipping Address</div>
                        <div class="detail-value">${order.customer.address}<br>${order.customer.city}, ${order.customer.postalCode}</div>
                    </div>
                    ${order.customer.instructions ? `<div class="detail-item" style="margin-top: 15px;">
                        <div class="detail-label">Delivery Instructions</div>
                        <div class="detail-value">${order.customer.instructions}</div>
                    </div>` : ''}
                </div>

                <div class="detail-section">
                    <h3>üì¶ Order Items</h3>
                    <div class="items-list">
                        ${order.items.map(item => `
                            <div class="item-row">
                                <span class="item-name">${item.name}</span>
                                <span class="item-qty">√ó${item.quantity}</span>
                                <span class="item-price">‡ß≥${(item.price * item.quantity).toLocaleString()}</span>
                            </div>
                        `).join('')}
                        <div class="item-row" style="border-top: 2px solid #555; padding-top: 10px; margin-top: 10px; font-weight: 700;">
                            <span>Total</span>
                            <span></span>
                            <span class="item-price" style="font-size: 1.1rem;">‡ß≥${order.total.toLocaleString()}</span>
                        </div>
                    </div>
                </div>

                <div class="status-update">
                    <label style="color: var(--gold); font-weight: 700; margin-bottom: 10px; display: block;">Update Order Status:</label>
                    <select class="status-select" id="statusSelect">
                        <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>‚è≥ Pending</option>
                        <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>‚úÖ Confirmed</option>
                        <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>üì§ Shipped</option>
                        <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>üöö Delivered</option>
                        <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>‚ùå Cancelled</option>
                    </select>
                    <button class="update-status-btn" onclick="updateOrderStatus('${order.id}')">Update Status</button>
                    <button class="delete-order-btn" onclick="deleteOrder('${order.id}')">üóëÔ∏è Delete Order</button>
                </div>
            `;

            modal.classList.add('show');
        }

        function getPaymentLabel(method) {
            const methods = {
                'cod': 'üíµ Cash on Delivery',
                'bkash': 'üîµ bKash',
                'nagad': 'üü† Nagad',
                'card': 'üí≥ Credit/Debit Card'
            };
            return methods[method] || method;
        }

        function updateOrderStatus(orderId) {
            const status = document.getElementById('statusSelect').value;
            const orders = getAdminOrders();
            const order = orders.find(o => o.id === orderId);

            if (order) {
                order.status = status;
                localStorage.setItem('orders', JSON.stringify(orders));
                updateStats();
                renderAdminOrders(currentFilter);
                alert(`‚úì Order status updated to: ${status}`);
                closeOrderModal();
            }
        }

        function deleteOrder(orderId) {
            if (confirm('Are you sure you want to delete this order?')) {
                let orders = getAdminOrders();
                orders = orders.filter(o => o.id !== orderId);
                localStorage.setItem('orders', JSON.stringify(orders));
                updateStats();
                renderAdminOrders(currentFilter);
                closeOrderModal();
                alert('Order deleted successfully');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('adminLoggedIn');
                window.location.href = 'index.html';
            }
        }

        function toggleAddProductForm() {
            const form = document.getElementById('addProductForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'block') {
                form.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function addNewProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const original = parseFloat(document.getElementById('productOriginal').value) || price;
            const rating = parseFloat(document.getElementById('productRating').value);
            const image = document.getElementById('productImage').value.trim();
            const imagesText = document.getElementById('productImages').value.trim();
            const videoUrl = document.getElementById('productVideo').value.trim();
            const description = document.getElementById('productDescription').value.trim();

            if (!name || !category || !price || !rating || !image || !description) {
                alert('‚ùå Please fill in all required fields (marked with *)');
                return;
            }

            if (rating < 0 || rating > 5) {
                alert('‚ùå Rating must be between 0 and 5');
                return;
            }

            if (price < 0) {
                alert('‚ùå Price must be a positive number');
                return;
            }

            // Parse additional images
            const images = [image];
            if (imagesText) {
                imagesText.split('\n').forEach(url => {
                    const trimmed = url.trim();
                    if (trimmed) images.push(trimmed);
                });
            }

            // Get current products from script.js
            // parse sizes (comma or newline separated)
            const sizesText = (document.getElementById('productSizes') && document.getElementById('productSizes').value) ? document.getElementById('productSizes').value.trim() : '';
            const sizes = sizesText ? sizesText.split(/[,\n]+/).map(s=>s.trim()).filter(Boolean) : [];

            const newProduct = {
                id: products.length + 1,
                name: name,
                category: category,
                price: price,
                original: original,
                rating: rating,
                image: image,
                images: images,
                videoUrl: videoUrl || '',
                description: description,
                sizes: sizes
            };

            // Add to products array in script.js
            products.push(newProduct);
            localStorage.setItem('products', JSON.stringify(products));

            // Clear form
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productOriginal').value = '';
            document.getElementById('productRating').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('productImages').value = '';
            document.getElementById('productSizes').value = '';
            document.getElementById('productVideo').value = '';
            document.getElementById('productDescription').value = '';

            // Hide form
            document.getElementById('addProductForm').style.display = 'none';

            // Re-render products list
            if (typeof renderProductsList === 'function') renderProductsList();

            if (window.showToast) showToast(`‚úÖ Product "${name}" added successfully!`, 'success'); else alert(`‚úÖ Product "${name}" added successfully!`);
        }

        function renderProductsList() {
            const productsList = document.getElementById('productsList');
            const productsEmpty = document.getElementById('productsEmpty');

            if (!products || products.length === 0) {
                productsList.innerHTML = '';
                productsEmpty.style.display = 'block';
                return;
            }

            productsEmpty.style.display = 'none';

            productsList.innerHTML = products.map(product => `
                <div class="product-item" style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; background: #f9f9f9;">
                    <div style="display: flex; gap: 15px;">
                        <!-- Product Image -->
                        <img src="${product.image}" alt="${product.name}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd;">

                        <!-- Product Info -->
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 5px 0; color: #333; font-size: 16px;">${product.name} ${product.featured ? '<span style="color: #d4af37; font-weight: 700; margin-left:8px;">‚≠ê Featured</span>' : ''}</h3>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Category:</strong> ${product.category}
                            </p>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Price:</strong> ‡ß≥${product.price.toLocaleString()} 
                                <span style="text-decoration: line-through; color: #999;">‡ß≥${product.original.toLocaleString()}</span>
                                | <strong>Rating:</strong> ‚≠ê ${product.rating}
                            </p>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Images:</strong> ${product.images ? product.images.length : 1} 
                                ${product.videoUrl ? '| üé¨ Video' : ''}
                            </p>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 8px; flex-direction: column; height: fit-content;">
                            <button onclick="editProduct(${product.id})" style="padding: 8px 12px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; white-space: nowrap;">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="toggleFeatured(${product.id})" style="padding: 8px 12px; background: ${product.featured ? '#777' : '#d4af37'}; color: ${product.featured ? '#fff' : '#000'}; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; white-space: nowrap;">
                                ${product.featured ? 'Remove Feature' : '‚≠ê Feature'}
                            </button>
                            <button onclick="deleteProduct(${product.id})" style="padding: 8px 12px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; white-space: nowrap;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                if (window.showToast) showToast('‚ùå Product not found', 'error'); else alert('‚ùå Product not found');
                return;
            }

            if (!confirm(`‚ö†Ô∏è Are you sure you want to delete "${product.name}"? This action cannot be undone.`)) {
                return;
            }

            // Remove from array
            products = products.filter(p => p.id !== productId);
            localStorage.setItem('products', JSON.stringify(products));

            // Re-render list
            renderProductsList();

            if (window.showToast) showToast(`‚úÖ Product "${product.name}" deleted successfully!`, 'success'); else alert(`‚úÖ Product "${product.name}" deleted successfully!`);
        }

        // Toggle featured status quickly from admin list
        function toggleFeatured(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                if (window.showToast) showToast('‚ùå Product not found', 'error'); else alert('‚ùå Product not found');
                return;
            }

            // If toggling on, ensure only one featured product
            const willFeature = !product.featured;
            if (willFeature) {
                products.forEach(p => { p.featured = false; });
            }

            product.featured = willFeature;

            // Persist and re-render
            localStorage.setItem('products', JSON.stringify(products));
            renderProductsList();

            if (window.showToast) showToast(willFeature ? `‚≠ê "${product.name}" is now featured.` : `‚úîÔ∏è "${product.name}" is no longer featured.`, 'info'); else alert(willFeature ? `‚≠ê "${product.name}" is now featured.` : `‚úîÔ∏è "${product.name}" is no longer featured.`);
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert('‚ùå Product not found');
                return;
            }

            // Populate edit form with product data
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductCategory').value = product.category;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductOriginal').value = product.original;
            document.getElementById('editProductRating').value = product.rating;
            document.getElementById('editProductSizes').value = (product.sizes && Array.isArray(product.sizes)) ? product.sizes.join(',') : '';
            document.getElementById('editProductDescription').value = product.description;
            document.getElementById('editProductSales').value = product.sales || 0;
            document.getElementById('editProductFeatured').checked = product.featured || false;
                // Populate image fields and preview
                try {
                    document.getElementById('editProductImage').value = product.image || '';
                    document.getElementById('editProductImageFile').value = '';
                    const imgs = (product.images && Array.isArray(product.images)) ? product.images : (product.images ? [product.images] : []);
                    document.getElementById('editProductImages').value = imgs.join('\n');
                    const preview = document.getElementById('editProductPreview');
                    if (preview) {
                        if (product.image) {
                            preview.innerHTML = `<img src="${product.image}" style="max-width:100%; max-height:100%; display:block; object-fit:cover;">`;
                        } else {
                            preview.innerHTML = '<span style="color:#666;">No image preview</span>';
                        }
                    }
                } catch (e) { console.warn('Preview setup failed', e); }

                // Show edit form modal
                document.getElementById('editProductModal').style.display = 'block';

                // Load colors for this product
                renderProductColors(product.colors || []);
        }

        // PRODUCT COLOR MANAGEMENT
        function renderProductColors(colors) {
            const container = document.getElementById('editProductColorsList');
            if (!container) return;
            
            container.innerHTML = colors.map((color, idx) => `
                <div style="display: grid; grid-template-columns: 1fr 1fr 40px; gap: 10px; align-items: center; background: white; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                    <input type="text" placeholder="Color name (e.g., Red, Blue)" value="${color.name || ''}" onchange="updateColorInList(${idx}, 'name', this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: Poppins;">
                    <input type="text" placeholder="Color image URL" value="${color.image || ''}" onchange="updateColorInList(${idx}, 'image', this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: Poppins;">
                    <button type="button" onclick="removeColorFromList(${idx})" style="background: #dc3545; color: white; border: none; padding: 8px 10px; border-radius: 4px; cursor: pointer;">‚úï</button>
                </div>
            `).join('');
        }

        function addColorField() {
            const container = document.getElementById('editProductColorsList');
            if (!container) return;
            
            const currentColors = [];
            container.querySelectorAll('input[placeholder*="Color name"]').forEach((input, idx) => {
                const nameInput = input;
                const imageInput = input.parentElement.querySelector('input[placeholder*="Color image"]');
                currentColors.push({
                    name: nameInput.value || '',
                    image: imageInput.value || ''
                });
            });
            
            currentColors.push({ name: '', image: '' });
            renderProductColors(currentColors);
        }

        function updateColorInList(idx, field, value) {
            const container = document.getElementById('editProductColorsList');
            if (!container) return;
            
            const colors = [];
            container.querySelectorAll('input[placeholder*="Color name"]').forEach((input) => {
                const nameInput = input;
                const imageInput = input.parentElement.querySelector('input[placeholder*="Color image"]');
                colors.push({
                    name: nameInput.value || '',
                    image: imageInput.value || ''
                });
            });
            
            if (idx < colors.length) {
                colors[idx][field] = value;
                renderProductColors(colors);
            }
        }

        function removeColorFromList(idx) {
            const container = document.getElementById('editProductColorsList');
            if (!container) return;
            
            const colors = [];
            container.querySelectorAll('input[placeholder*="Color name"]').forEach((input) => {
                const nameInput = input;
                const imageInput = input.parentElement.querySelector('input[placeholder*="Color image"]');
                colors.push({
                    name: nameInput.value || '',
                    image: imageInput.value || ''
                });
            });
            
            colors.splice(idx, 1);
            renderProductColors(colors);
        }

        // HERO MANAGEMENT FUNCTIONS
        function loadHeroItems() {
            const raw = localStorage.getItem('heroItems');
            let items = [];
            if (raw) {
                try { items = JSON.parse(raw) || []; } catch(e) { items = []; }
            }
            return items;
        }

        function renderHeroList() {
            const list = document.getElementById('heroList');
            const empty = document.getElementById('heroEmpty');
            let items = loadHeroItems();
            if (!items || items.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            list.innerHTML = items.map(h => `
                <div style="padding:12px;border-radius:8px;background:#111;border:1px solid #222;display:flex;align-items:center;gap:12px;">
                    <img src="${h.image}" alt="${h.title}" style="width:100px;height:70px;object-fit:cover;border-radius:6px;border:1px solid #333;" onerror="this.src='https://via.placeholder.com/150x100?text=${encodeURIComponent(h.title)}'" />
                    <div style="flex:1;">
                        <div style="display:flex;align-items:center;gap:10px;">
                            <strong style="color:#fff">${h.title}</strong>
                            ${h.active ? '<span style="color:#d4af37;font-weight:700;">‚≠ê Active</span>' : ''}
                        </div>
                        <div style="color:#ccc;font-size:0.9rem;">${h.subtitle ? (h.subtitle.length>90? h.subtitle.slice(0,90)+'...' : h.subtitle) : ''}</div>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:8px;">
                        <button onclick="editHero(${h.id})" style="padding:8px 10px;background:#0066cc;color:#fff;border:none;border-radius:6px;">Edit</button>
                        <button onclick="toggleHeroActive(${h.id})" style="padding:8px 10px;background:${h.active? '#777' : '#d4af37'};color:${h.active? '#fff':'#000'};border:none;border-radius:6px;">${h.active? 'Deactivate' : 'Activate'}</button>
                        <button onclick="deleteHero(${h.id})" style="padding:8px 10px;background:#dc3545;color:#fff;border:none;border-radius:6px;">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function openAddHeroModal() {
            document.getElementById('heroId').value = '';
            document.getElementById('heroTitle').value = '';
            document.getElementById('heroSubtitle').value = '';
            document.getElementById('heroImage').value = '';
            document.getElementById('heroCtaText').value = '';
            document.getElementById('heroCtaLink').value = '';
            document.getElementById('heroActive').checked = true;
            document.getElementById('editHeroModal').style.display = 'block';
        }

        function closeEditHeroModal() {
            document.getElementById('editHeroModal').style.display = 'none';
        }

        function saveHeroChanges() {
            const id = document.getElementById('heroId').value;
            const title = document.getElementById('heroTitle').value.trim();
            const subtitle = document.getElementById('heroSubtitle').value.trim();
            const image = document.getElementById('heroImage').value.trim();
            const ctaText = document.getElementById('heroCtaText').value.trim();
            const ctaLink = document.getElementById('heroCtaLink').value.trim();
            const active = document.getElementById('heroActive').checked;

            if (!title) { if (window.showToast) showToast('Title is required', 'warn'); else alert('Title is required'); return; }

            let items = loadHeroItems();
            if (id) {
                // edit existing
                items = items.map(h => {
                    if (String(h.id) === String(id)) {
                        return Object.assign({}, h, { title, subtitle, image, ctaText, ctaLink, active });
                    }
                    return h;
                });
            } else {
                const newItem = { id: Date.now(), title, subtitle, image, ctaText, ctaLink, active };
                items.push(newItem);
            }
            localStorage.setItem('heroItems', JSON.stringify(items));
            renderHeroList();
            closeEditHeroModal();
            if (window.showToast) showToast('‚úÖ Hero items updated', 'success'); else alert('‚úÖ Hero items updated');
            // notify other tabs
            try { localStorage.setItem('heroItems', JSON.stringify(items)); } catch(e) {}
        }

        function editHero(id) {
            const items = loadHeroItems();
            const h = items.find(x => String(x.id) === String(id));
            if (!h) { if (window.showToast) showToast('Hero not found', 'error'); else alert('Hero not found'); return; }
            document.getElementById('heroId').value = h.id;
            document.getElementById('heroTitle').value = h.title || '';
            document.getElementById('heroSubtitle').value = h.subtitle || '';
            document.getElementById('heroImage').value = h.image || '';
            document.getElementById('heroCtaText').value = h.ctaText || '';
            document.getElementById('heroCtaLink').value = h.ctaLink || '';
            document.getElementById('heroActive').checked = !!h.active;
            document.getElementById('editHeroModal').style.display = 'block';
        }

        function deleteHero(id) {
            if (!confirm('Delete this hero item?')) return;
            let items = loadHeroItems();
            items = items.filter(h => String(h.id) !== String(id));
            localStorage.setItem('heroItems', JSON.stringify(items));
            renderHeroList();
            if (window.showToast) showToast('‚úÖ Hero deleted', 'success'); else alert('‚úÖ Hero deleted');
        }

        function toggleHeroActive(id) {
            let items = loadHeroItems();
            items = items.map(h => {
                if (String(h.id) === String(id)) {
                    return Object.assign({}, h, { active: !h.active });
                }
                return h;
            });
            localStorage.setItem('heroItems', JSON.stringify(items));
            renderHeroList();
        }

        function closeEditProductModal() {
            document.getElementById('editProductModal').style.display = 'none';
        }

        function saveProductChanges() {
            const productId = parseInt(document.getElementById('editProductId').value);
            const product = products.find(p => p.id === productId);

            if (!product) {
                alert('‚ùå Product not found');
                return;
            }

            // Get updated values
            const name = document.getElementById('editProductName').value.trim();
            const category = document.getElementById('editProductCategory').value.trim();
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const original = parseFloat(document.getElementById('editProductOriginal').value);
            const rating = parseFloat(document.getElementById('editProductRating').value);
            const description = document.getElementById('editProductDescription').value.trim();
            const sales = parseInt(document.getElementById('editProductSales').value) || 0;
            const featured = document.getElementById('editProductFeatured').checked;

            // Validation
            if (!name || !category || !price || isNaN(rating) || !description) {
                alert('‚ùå Please fill in all required fields');
                return;
            }

            if (rating < 0 || rating > 5) {
                alert('‚ùå Rating must be between 0 and 5');
                return;
            }

            if (price < 0) {
                alert('‚ùå Price must be a positive number');
                return;
            }

            // If marking as featured, unmark other featured products
            if (featured) {
                products.forEach(p => {
                    if (p.id !== productId) {
                        p.featured = false;
                    }
                });
            }

            // Helper to finalize save (used after potential async file read)
            function finalizeSave(imageValue) {
                product.name = name;
                product.category = category;
                product.price = price;
                product.original = original || price;
                product.rating = rating;
                product.description = description;
                // parse sizes (comma or newline separated)
                const sizesText = (document.getElementById('editProductSizes').value || '').trim();
                product.sizes = sizesText ? sizesText.split(/[,\n]+/).map(s=>s.trim()).filter(Boolean) : [];
                product.sales = sales;
                product.featured = featured;

                // Images: imageValue will be prioritized if provided (data URL or URL)
                if (imageValue) {
                    product.image = imageValue;
                } else {
                    // if no new image provided, keep existing or take URL field
                    const urlField = (document.getElementById('editProductImage') && document.getElementById('editProductImage').value.trim()) || product.image || '';
                    product.image = urlField;
                }

                // parse additional image URLs
                const imgsText = (document.getElementById('editProductImages') && document.getElementById('editProductImages').value.trim()) ? document.getElementById('editProductImages').value.trim() : '';
                const additional = imgsText ? imgsText.split(/[\n,]+/).map(u=>u.trim()).filter(Boolean) : [];
                product.images = [product.image].concat(additional.filter(u=>u && u !== product.image));

                // Save colors from color fields
                const colors = [];
                const colorsList = document.getElementById('editProductColorsList');
                if (colorsList) {
                    colorsList.querySelectorAll('input[placeholder*="Color name"]').forEach((input) => {
                        const nameInput = input;
                        const imageInput = input.parentElement.querySelector('input[placeholder*="Color image"]');
                        if (nameInput.value.trim()) {
                            colors.push({
                                name: nameInput.value.trim(),
                                image: imageInput.value.trim()
                            });
                        }
                    });
                }
                product.colors = colors;

                // Save to localStorage
                localStorage.setItem('products', JSON.stringify(products));

                // Close modal and refresh list
                closeEditProductModal();
                renderProductsList();

                if (window.showToast) showToast(`‚úÖ Product "${name}" updated successfully!`, 'success'); else alert(`‚úÖ Product "${name}" updated successfully!`);
            }

            // Check for file upload (async)
            const fileEl = document.getElementById('editProductImageFile');
            if (fileEl && fileEl.files && fileEl.files[0]) {
                const file = fileEl.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const dataUrl = e.target.result;
                        finalizeSave(dataUrl);
                    } catch (err) {
                        console.error('Failed to read image file', err);
                        alert('Failed to read uploaded image. Please try again.');
                    }
                };
                reader.readAsDataURL(file);
                return; // finalize will run in reader.onload
            }

            // No file uploaded, but maybe URL provided
            const urlVal = document.getElementById('editProductImage') && document.getElementById('editProductImage').value.trim();
            finalizeSave(urlVal || null);
        }

        function searchProducts() {
            const query = document.getElementById('productSearch').value.toLowerCase();
            const productsList = document.getElementById('productsList');
            const productsEmpty = document.getElementById('productsEmpty');

            if (!products || products.length === 0) {
                productsList.innerHTML = '';
                productsEmpty.style.display = 'block';
                return;
            }

            const filtered = products.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.category.toLowerCase().includes(query)
            );

            if (filtered.length === 0) {
                productsList.innerHTML = '';
                productsEmpty.innerHTML = 'No products found matching "' + query + '".';
                productsEmpty.style.display = 'block';
                return;
            }

            productsEmpty.style.display = 'none';

            productsList.innerHTML = filtered.map(product => `
                <div class="product-item" style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; background: #f9f9f9;">
                    <div style="display: flex; gap: 15px;">
                        <!-- Product Image -->
                        <img src="${product.image}" alt="${product.name}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd;">

                        <!-- Product Info -->
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 5px 0; color: #333; font-size: 16px;">${product.name}</h3>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Category:</strong> ${product.category}
                            </p>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Price:</strong> ‡ß≥${product.price.toLocaleString()} 
                                <span style="text-decoration: line-through; color: #999;">‡ß≥${product.original.toLocaleString()}</span>
                                | <strong>Rating:</strong> ‚≠ê ${product.rating}
                            </p>
                            <p style="margin: 2px 0; color: #666; font-size: 13px;">
                                <strong>Images:</strong> ${product.images ? product.images.length : 1} 
                                ${product.videoUrl ? '| üé¨ Video' : ''}
                            </p>
                        </div>

                        <!-- Delete Button -->
                        <button onclick="deleteProduct(${product.id})" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; height: fit-content;">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function searchOrders() {
            const query = document.querySelector('.searchbar input').value.toLowerCase();
            const orders = getAdminOrders();
            const filtered = orders.filter(o =>
                o.id.toLowerCase().includes(query) ||
                o.customer.firstName.toLowerCase().includes(query) ||
                o.customer.lastName.toLowerCase().includes(query) ||
                o.customer.phone.toLowerCase().includes(query)
            );

            const tableBody = document.getElementById('ordersTableBody');
            if (filtered.length === 0) {
                tableBody.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><h2>No results found</h2></div>';
                return;
            }

            tableBody.innerHTML = filtered.map(order => `
                <div class="table-row">
                    <div class="order-id">${order.id}</div>
                    <div>
                        <div class="customer-name">${order.customer.firstName} ${order.customer.lastName}</div>
                        <div class="customer-phone">${order.customer.phone}</div>
                    </div>
                    <div>
                        <div class="small" style="color: #fff;">${order.customer.address}</div>
                        <div class="small">${order.customer.city}, ${order.customer.postalCode}</div>
                    </div>
                    <div class="order-date">${order.date}</div>
                    <div class="order-items">${order.items.length} item(s)</div>
                    <div class="order-total">‡ß≥${order.total.toLocaleString()}</div>
                    <div>
                        <div class="status-badge status-${order.status.toLowerCase()}">${order.status}</div>
                    </div>
                    <div class="action-btns" style="justify-content: center;">
                        <button class="action-btn" onclick="viewOrderDetails('${order.id}')">üëÅÔ∏è View</button>
                        <button class="action-btn" onclick="window.open('invoice.html?id=${order.id}', '_blank')" style="background: var(--gold); color: #000; border-color: var(--gold);">üìÑ Invoice</button>
                    </div>
                </div>
            `).join('');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('show');
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            updateStats();
            renderAdminOrders('all');
            // render customers list in admin
            if (typeof renderCustomers === 'function') renderCustomers();
            // render products inventory list
            if (typeof renderProductsList === 'function') renderProductsList();
        });

        // Product search event listener
        const productSearchInput = document.getElementById('productSearch');
        if (productSearchInput) {
            productSearchInput.addEventListener('input', function() {
                searchProducts();
            });
        }

        // Close modal when clicking outside
        document.getElementById('orderModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeOrderModal();
            }
        });

        // ---- Edit product image helpers and preview handlers ----
        function showAdminAlert(message, type='info', duration=4000) {
            try {
                const el = document.getElementById('adminAlert');
                if (!el) return;
                el.className = 'admin-alert ' + (type || 'info') + ' show';
                el.innerHTML = message;
                el.style.display = 'block';
                if (duration > 0) setTimeout(()=>{ el.className = 'admin-alert ' + (type || 'info'); el.style.display = 'none'; }, duration);
            } catch (e) { console.warn('showAdminAlert failed', e); }
        }

        function clearEditImageFile(){
            const f = document.getElementById('editProductImageFile');
            if (f) f.value = '';
            const url = document.getElementById('editProductImage');
            if (url) url.value = '';
            const preview = document.getElementById('editProductPreview');
            if (preview) preview.innerHTML = '<span style="color:#666;">No image preview</span>';
        }

        (function setupEditImageHandlers(){
            const fileEl = document.getElementById('editProductImageFile');
            const urlEl = document.getElementById('editProductImage');
            const preview = document.getElementById('editProductPreview');
            if (fileEl) {
                fileEl.addEventListener('change', function(e){
                    const f = e.target.files && e.target.files[0];
                    if (!f) return;
                    const reader = new FileReader();
                    reader.onload = function(ev){
                        if (preview) preview.innerHTML = `<img src="${ev.target.result}" style="max-width:100%; max-height:100%; display:block; object-fit:cover;">`;
                        if (urlEl) urlEl.value = '';
                    };
                    reader.readAsDataURL(f);
                });
            }

            if (urlEl) {
                urlEl.addEventListener('input', function(e){
                    const v = (e.target.value || '').trim();
                    if (!preview) return;
                    if (!v) { preview.innerHTML = '<span style="color:#666;">No image preview</span>'; return; }
                    // set preview to url (may 404 but useful)
                    preview.innerHTML = `<img src="${v}" style="max-width:100%; max-height:100%; display:block; object-fit:cover;" onerror="this.parentNode.innerHTML='<span style=\"color:#666;\">Image failed to load</span>'">`;
                });
            }
        })();

        // ---- Header scroll behavior for admin: make header resemble compact user panel on scroll ----
        (function adminHeaderScroll(){
            const headerEl = document.querySelector('header');
            if (!headerEl) return;
            function check() {
                if (window.scrollY > 40) {
                    headerEl.classList.add('admin-scrolled');
                    document.body.style.paddingTop = headerEl.offsetHeight + 'px';
                } else {
                    headerEl.classList.remove('admin-scrolled');
                    document.body.style.paddingTop = '';
                }
            }
            window.addEventListener('scroll', check);
            document.addEventListener('DOMContentLoaded', check);
            // initial check in case already scrolled
            setTimeout(check, 120);
        })();

        // Customers management functions
        function getCustomers() {
            return JSON.parse(localStorage.getItem('customers') || '[]');
        }

        function renderCustomers() {
            const list = document.getElementById('customersList');
            const empty = document.getElementById('customersEmpty');
            if (!list) return;
            const customers = getCustomers();
            if (!customers || customers.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            list.innerHTML = customers.map((c, idx) => `
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#0f0f0f;border:1px solid #222;border-radius:6px;">
                    <div>
                        <div style="font-weight:700;color:var(--gold);">${c.name || '‚Äî'}</div>
                        <div style="color:#bbb;font-size:0.9rem">${c.email}</div>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <button onclick="viewCustomer('${c.email.replace(/'/g,'\'')}')" class="action-btn">üëÅÔ∏è View</button>
                        <button onclick="deleteCustomer('${c.email.replace(/'/g,'\'')}')" class="action-btn" style="background:#b22222">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Orders + Incomplete orders management for admin
        function getAdminOrders() {
            // load completed orders
            const completed = JSON.parse(localStorage.getItem('orders') || '[]');
            // load partial / incomplete orders
            const partials = JSON.parse(localStorage.getItem('incompleteOrders') || '[]');
            // normalize partials into order-like objects
            const mappedPartials = (partials || []).map(p => ({
                id: p.id || ('PART' + (p.timestamp||Date.now())),
                date: p.timestamp ? new Date(p.timestamp).toLocaleString() : '‚Äî',
                customer: p.customer || {},
                items: p.items || [],
                total: p.total || 0,
                status: (p.status || 'Incomplete'),
                meta: { partial: true, progress: p.progress || {} }
            }));

            // mark completed orders with meta.partial = false
            const mappedCompleted = (completed || []).map(o => Object.assign({}, o, { meta: { partial: false } }));

            // Return partials first then completed
            return mappedPartials.concat(mappedCompleted);
        }

        function renderAdminOrders(filter='all'){
            const orders = getAdminOrders();
            const tableBody = document.getElementById('ordersTableBody');
            if(!tableBody) return;

            let filtered = orders;
            if(filter === 'incomplete') filtered = orders.filter(o=> o.meta && o.meta.partial);
            if(filter === 'completed') filtered = orders.filter(o=> !(o.meta && o.meta.partial));

            if(filtered.length === 0){
                tableBody.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><h2>No orders yet</h2></div>';
                return;
            }

            tableBody.innerHTML = filtered.map(order => `
                <div class="table-row">
                    <div class="order-id">${order.id}</div>
                    <div>
                        <div class="customer-name">${(order.customer.firstName||'') + ' ' + (order.customer.lastName||'')}</div>
                        <div class="customer-phone">${order.customer.phone || (order.customer.email||'‚Äî')}</div>
                    </div>
                    <div>
                        <div class="small" style="color: #fff;">${order.customer.address || '‚Äî'}</div>
                        <div class="small">${order.customer.city || ''} ${order.customer.postalCode || ''}</div>
                    </div>
                    <div class="order-date">${order.date || ''}</div>
                    <div class="order-items">${order.items ? order.items.length : 0} item(s)</div>
                    <div class="order-total">‡ß≥${(order.total || 0).toLocaleString()}</div>
                    <div>
                        <div class="status-badge" style="background:${order.meta && order.meta.partial ? '#d97706' : '#0b3d0b'};">${order.status}</div>
                    </div>
                    <div class="action-btns" style="justify-content:center;">
                        <button class="action-btn" onclick="viewOrderDetails('${order.id}')">üëÅÔ∏è View</button>
                        ${order.meta && order.meta.partial ? `<button class="action-btn" onclick="markPartialClosed('${order.id}')" style="background:#b22222">Mark Closed</button>` : `<button class="action-btn" onclick="window.open('invoice.html?id=${order.id}', '_blank')" style="background: var(--gold); color: #000; border-color: var(--gold);">üìÑ Invoice</button>`}
                    </div>
                </div>
            `).join('');
        }

        function viewOrderDetails(orderId){
            const orders = getAdminOrders();
            const o = orders.find(x=> String(x.id) === String(orderId));
            if(!o){ if(window.showToast) showToast('Order not found','error'); else alert('Order not found'); return; }

            // Build detailed HTML but reuse the existing modal markup (#orderModal, #modalOrderId, #modalContent)
            const detailHtml = `
                <div class="detail-section">
                    <h3>üìã Order Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Order Status</div>
                            <div class="detail-value"><span class="status-badge status-${(o.status||'').toLowerCase()}" style="display:inline-block;">${o.status || ''}</span></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Order Date</div>
                            <div class="detail-value">${o.date || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Payment Method</div>
                            <div class="detail-value">${getPaymentLabel(o.payment || (o.meta && o.meta.payment) || '')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Amount</div>
                            <div class="detail-value" style="color: var(--gold); font-size: 1.2rem;">‡ß≥${(o.total || 0).toLocaleString()}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üë§ Customer Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Name</div>
                            <div class="detail-value">${(o.customer && ((o.customer.firstName || o.customer.name) + ' ' + (o.customer.lastName || '')) ) || (o.customer && o.customer.name) || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value">${(o.customer && (o.customer.phone || '‚Äî'))}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${(o.customer && (o.customer.email || '‚Äî'))}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">City</div>
                            <div class="detail-value">${(o.customer && (o.customer.city || '‚Äî'))}</div>
                        </div>
                    </div>
                    <div class="detail-item" style="margin-top:15px;">
                        <div class="detail-label">Shipping Address</div>
                        <div class="detail-value">${(o.customer && (o.customer.address || '‚Äî'))}<br>${(o.customer && ((o.customer.city || '') + (o.customer.postalCode ? (', ' + o.customer.postalCode) : ''))) || ''}</div>
                    </div>
                    ${(o.customer && o.customer.instructions) ? `<div class="detail-item" style="margin-top:15px;"><div class="detail-label">Delivery Instructions</div><div class="detail-value">${o.customer.instructions}</div></div>` : ''}
                </div>

                <div class="detail-section">
                    <h3>üì¶ Order Items</h3>
                    <div class="items-list">
                        ${(o.items || []).map(item => `
                            <div class="item-row">
                                <span class="item-name">${item.name || item.title || 'Item'}</span>
                                <span class="item-qty">√ó${item.quantity || 1}</span>
                                <span class="item-price">‡ß≥${((item.price || 0) * (item.quantity || 1)).toLocaleString()}</span>
                            </div>
                        `).join('')}
                        <div class="item-row" style="border-top: 2px solid #555; padding-top: 10px; margin-top: 10px; font-weight: 700;">
                            <span>Total</span>
                            <span></span>
                            <span class="item-price" style="font-size: 1.1rem;">‡ß≥${(o.total || 0).toLocaleString()}</span>
                        </div>
                    </div>
                </div>

                <div style="text-align:right; margin-top:12px;">
                    <button onclick="closeOrderModal()" class="action-btn">Close</button>
                </div>
            `;

            // Use the existing modal elements (declared earlier in the file)
            const modal = document.getElementById('orderModal');
            const modalTitle = document.getElementById('modalOrderId');
            const modalContent = document.getElementById('modalContent');
            if (modalTitle) modalTitle.textContent = `Order: ${o.id}`;
            if (modalContent) modalContent.innerHTML = detailHtml;
            if (modal) modal.classList.add('show');
        }

        function markPartialClosed(id){
            if(!confirm('Mark this partial order as closed/handled?')) return;
            let partials = JSON.parse(localStorage.getItem('incompleteOrders')||'[]');
            partials = partials.map(p=>{ if(String(p.id)===String(id)) p.status='closed'; return p; });
            localStorage.setItem('incompleteOrders', JSON.stringify(partials));
            if(window.showToast) showToast('Marked partial order closed','info'); else alert('Marked partial order closed');
            renderAdminOrders('all');
        }

        function viewCustomer(email) {
            const customers = getCustomers();
            const c = customers.find(u => u.email === email);
            if (!c) { if (window.showToast) showToast('Customer not found','error'); else alert('Customer not found'); return; }

            // Find orders for this customer (completed + partials)
            const completed = JSON.parse(localStorage.getItem('orders') || '[]');
            const partials = JSON.parse(localStorage.getItem('incompleteOrders') || '[]');
            const matches = [];

            const emailKey = (c.email || '').toLowerCase();
            const phoneKey = (c.phone || '').toLowerCase();

            (completed || []).forEach(o => {
                const oe = (o.customer && ((o.customer.email || '') + '' )).toLowerCase();
                const op = (o.customer && ((o.customer.phone || '') + '' )).toLowerCase();
                if ((emailKey && oe === emailKey) || (phoneKey && op === phoneKey)) matches.push(Object.assign({}, o, { meta: { partial: false } }));
            });

            (partials || []).forEach(p => {
                const pe = (p.customer && ((p.customer.email || '') + '' )).toLowerCase();
                const pp = (p.customer && ((p.customer.phone || '') + '' )).toLowerCase();
                if ((emailKey && pe === emailKey) || (phoneKey && pp === phoneKey)) matches.push(Object.assign({}, p, { id: p.id || ('PART' + (p.timestamp||Date.now())), date: p.timestamp ? new Date(p.timestamp).toLocaleString() : '‚Äî', meta: { partial: true } }));
            });

            // Build professional styled customer details + orders
            const ordersHtml = matches.length ? matches.map(o => `
                <div class="order-card">
                    <div class="order-card-header">
                        <span class="order-card-id">üßæ ${o.id}</span>
                        <span class="status-badge status-${(o.meta && o.meta.partial ? 'warning' : o.status.toLowerCase())}"> ${o.status || (o.meta && o.meta.partial ? 'Incomplete' : '‚Äî')}</span>
                    </div>
                    <div class="order-card-date">${o.date || '‚Äî'}</div>
                    <div class="order-card-meta">üì¶ ${(o.items || []).length} item(s) | üí∞ ‡ß≥${(o.total||0).toLocaleString()}</div>
                </div>
            `).join('') : '<div class="order-empty">No orders found for this customer</div>';

            const html = `
                <div class="detail-section">
                    <h3>üë§ Customer Profile</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Full Name</div>
                            <div class="detail-value">${c.name || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone Number</div>
                            <div class="detail-value" style="font-family: 'Courier New', monospace;">${c.phone || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email Address</div>
                            <div class="detail-value" style="font-family: 'Courier New', monospace; word-break: break-all;">${c.email || '‚Äî'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Account Status</div>
                            <div class="detail-value">‚úÖ Active</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üßæ Order History (${matches.length})</h3>
                    <div class="orders-section">${ordersHtml}</div>
                </div>
            `;

            const modal = document.getElementById('orderModal');
            const modalTitle = document.getElementById('modalOrderId');
            const modalContent = document.getElementById('modalContent');
            if (modalTitle) modalTitle.textContent = `üë• Customer: ${c.name || c.email || c.phone}`;
            if (modalContent) modalContent.innerHTML = html;
            if (modal) modal.classList.add('show');
        }

        function updateStats(){
            const orders = JSON.parse(localStorage.getItem('orders')||'[]');
            const partials = JSON.parse(localStorage.getItem('incompleteOrders')||'[]');
            document.getElementById('statTotal').textContent = (orders.length + partials.length) || 0;
            document.getElementById('statPending').textContent = orders.filter(o=> o.status === 'Pending').length || 0;
            document.getElementById('statConfirmed').textContent = orders.filter(o=> o.status === 'Confirmed').length || 0;
            document.getElementById('statShipped').textContent = orders.filter(o=> o.status === 'Shipped').length || 0;
            document.getElementById('statDelivered').textContent = orders.filter(o=> o.status === 'Delivered').length || 0;
            const revenue = orders.reduce((s,o)=> s + (o.total||0), 0);
            document.getElementById('statRevenue').textContent = '‡ß≥' + revenue.toLocaleString();
            // total orders count element
            const totalOrdersEl = document.getElementById('totalOrders'); if(totalOrdersEl) totalOrdersEl.textContent = (orders.length + partials.length);
        }

        function deleteCustomer(email) {
            if (!confirm('Delete this customer? This cannot be undone.')) return;
            let customers = getCustomers();
            customers = customers.filter(u => u.email !== email);
            localStorage.setItem('customers', JSON.stringify(customers));
            renderCustomers();
            alert('Customer deleted');
        }

        function toggleCustomersPanel() {
            const p = document.getElementById('customersPanel');
            if (!p) return;
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
            if (p.style.display === 'block') {
                renderCustomers();
                p.scrollIntoView({behavior:'smooth'});
            }
        }

        // Announcement manager removed ‚Äî functions deleted

                // === Categories Manager JS ===
                function escapeHtml(unsafe) {
                        return String(unsafe)
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/"/g, '&quot;')
                            .replace(/'/g, '&#039;');
                }
        function getCategories() {
            try { return JSON.parse(localStorage.getItem('categories')) || []; } catch(e) { return []; }
        }

        function saveCategories(list) {
            localStorage.setItem('categories', JSON.stringify(list || []));
        }

        function openAddCategoryInput() {
            document.getElementById('addCategoryArea').style.display = 'block';
            document.getElementById('newCategoryName').focus();
        }

        function closeAddCategoryInput() {
            document.getElementById('addCategoryArea').style.display = 'none';
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryImageFile').value = '';
            document.getElementById('categoryDropZone').innerText = 'Drag & drop an image here or use the file input';
        }

        function addCategoryFromForm() {
            const nameEl = document.getElementById('newCategoryName');
            const fileEl = document.getElementById('newCategoryImageFile');
            const name = (nameEl && nameEl.value || '').trim();
            if (!name) { alert('Please enter a category name'); return; }

            const current = getCategories();
            const id = Date.now();

            // If a file is selected, read it as data URL
            const file = fileEl && fileEl.files && fileEl.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    current.push({ id: id, name: name, image: imageData });
                    saveCategories(current);
                    renderCategoriesList();
                    populateCategorySelect();
                    closeAddCategoryInput();
                    alert('Category added');
                };
                reader.readAsDataURL(file);
            } else {
                // no file, add with empty image
                current.push({ id: id, name: name, image: '' });
                saveCategories(current);
                renderCategoriesList();
                populateCategorySelect();
                closeAddCategoryInput();
                alert('Category added');
            }
        }

        function renderCategoriesList() {
            const listEl = document.getElementById('categoriesList');
            const empty = document.getElementById('categoriesEmpty');
            const categories = getCategories();
            if (!listEl) return;
            if (!categories || categories.length === 0) {
                listEl.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            listEl.innerHTML = categories.map((c, idx) => `
                <div class="category-item" draggable="true" data-id="${c.id}" style="display:flex;align-items:center;gap:12px;padding:10px;border:1px solid #222;background:#0f0f0f;border-radius:8px;">
                    <div style="width:64px;height:64px;flex-shrink:0;background:#111;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center;border:1px solid #333;">
                        ${c.image ? `<img src="${c.image}" style="max-width:100%;max-height:100%;display:block;"/>` : `<div style=\"color:#777;font-size:0.9rem;\">No image</div>`}
                    </div>
                    <div style="flex:1;color:#fff;">
                        <div style="font-weight:700;">${escapeHtml(c.name)}</div>
                        <div style="color:#bbb;font-size:0.85rem;">ID: ${c.id}</div>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <button onclick="editCategory('${c.id}')" style="padding:6px 10px;background:#0066cc;color:#fff;border:none;border-radius:6px;">Edit</button>
                        <button onclick="deleteCategory('${c.id}')" style="padding:6px 10px;background:#dc3545;color:#fff;border:none;border-radius:6px;">Delete</button>
                    </div>
                </div>
            `).join('');

            // attach drag handlers
            listEl.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('dragstart', categoryDragStart);
                item.addEventListener('dragover', categoryDragOver);
                item.addEventListener('drop', categoryDrop);
            });
            // update public sidebar in storefront (if available)
            try { if (typeof populateCategorySidebar === 'function') populateCategorySidebar(); } catch(e) {}
        }

        function editCategory(id) {
            const categories = getCategories();
            const c = categories.find(x => String(x.id) === String(id));
            if (!c) return alert('Category not found');
            const newName = prompt('Edit category name:', c.name || '');
            if (newName === null) return; // cancelled
            c.name = newName.trim() || c.name;
            saveCategories(categories);
            renderCategoriesList();
            populateCategorySelect();
        }

        function deleteCategory(id) {
            if (!confirm('Delete this category?')) return;
            let categories = getCategories();
            categories = categories.filter(x => String(x.id) !== String(id));
            saveCategories(categories);
            renderCategoriesList();
            populateCategorySelect();
        }

        // Drag and drop ordering handlers
        let draggedCategoryId = null;
        function categoryDragStart(e) { draggedCategoryId = this.getAttribute('data-id'); e.dataTransfer.effectAllowed = 'move'; }
        function categoryDragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }
        function categoryDrop(e) {
            e.preventDefault();
            const targetId = this.getAttribute('data-id');
            if (!draggedCategoryId || draggedCategoryId === targetId) return;
            let categories = getCategories();
            const draggedIndex = categories.findIndex(x => String(x.id) === String(draggedCategoryId));
            const targetIndex = categories.findIndex(x => String(x.id) === String(targetId));
            if (draggedIndex < 0 || targetIndex < 0) return;
            const [moved] = categories.splice(draggedIndex, 1);
            categories.splice(targetIndex, 0, moved);
            saveCategories(categories);
            renderCategoriesList();
            populateCategorySelect();
        }

        // allow dropping files into the drop zone
        const dropZone = document.getElementById('categoryDropZone');
        if (dropZone) {
            dropZone.addEventListener('dragover', function(e){ e.preventDefault(); this.style.borderColor = 'var(--gold)'; });
            dropZone.addEventListener('dragleave', function(e){ this.style.borderColor = '#333'; });
            dropZone.addEventListener('drop', function(e){
                e.preventDefault(); this.style.borderColor = '#333';
                const file = e.dataTransfer.files && e.dataTransfer.files[0];
                if (file) {
                    document.getElementById('newCategoryImageFile').files = e.dataTransfer.files;
                    this.innerText = file.name;
                }
            });
        }

        // wire file input change preview
        const catFileEl = document.getElementById('newCategoryImageFile');
        if (catFileEl) catFileEl.addEventListener('change', function(){
            const f = this.files && this.files[0];
            const zone = document.getElementById('categoryDropZone');
            if (f) zone.innerText = f.name; else zone.innerText = 'Drag & drop an image here or use the file input';
        });

        function populateCategorySelect() {
            // try to populate the add-product category select if present
            const sel = document.getElementById('productCategory');
            if (!sel) return;
            const categories = getCategories();
            // preserve manual entries if categories empty
            if (!categories || categories.length === 0) return;
            sel.innerHTML = '<option value="">Select Category</option>' + categories.map(c => `<option value="${escapeHtml(c.name)}">${escapeHtml(c.name)}</option>`).join('');
        }

        // initialize categories on load
        try { renderCategoriesList(); } catch(e) {}
        try { populateCategorySelect(); } catch(e) {}

        // === Inline Hero Add JS ===
        function toggleAddHeroInline() {
            const el = document.getElementById('addHeroInline');
            if (!el) return;
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
            const btn = document.getElementById('inlineHeroBtn');
            if (btn) btn.textContent = el.style.display === 'block' ? '‚úñ Close' : '‚ûï Inline Add';
        }

        function closeAddHeroInline() {
            const el = document.getElementById('addHeroInline'); if (!el) return; el.style.display = 'none';
            const btn = document.getElementById('inlineHeroBtn'); if (btn) btn.textContent = '‚ûï Inline Add';
            document.getElementById('inlineHeroTitle').value = '';
            document.getElementById('inlineHeroSubtitle').value = '';
            document.getElementById('inlineHeroCtaText').value = '';
            document.getElementById('inlineHeroCtaLink').value = '';
            document.getElementById('inlineHeroImageFile').value = '';
            document.getElementById('inlineHeroPreview').innerHTML = '';
        }

        function addHeroFromInlineForm() {
            const title = (document.getElementById('inlineHeroTitle').value || '').trim();
            if (!title) { alert('Title is required'); return; }
            const subtitle = (document.getElementById('inlineHeroSubtitle').value || '').trim();
            const ctaText = (document.getElementById('inlineHeroCtaText').value || '').trim();
            const ctaLink = (document.getElementById('inlineHeroCtaLink').value || '').trim();
            const active = !!document.getElementById('inlineHeroActive').checked;
            const fileEl = document.getElementById('inlineHeroImageFile');
            const file = fileEl && fileEl.files && fileEl.files[0];

            const items = loadHeroItems() || [];
            const id = Date.now();

            function pushHero(imageData) {
                const newItem = { id: id, title: title, subtitle: subtitle, image: imageData || '', ctaText: ctaText, ctaLink: ctaLink, active: !!active };
                items.push(newItem);
                localStorage.setItem('heroItems', JSON.stringify(items));
                renderHeroList();
                closeAddHeroInline();
                alert('Hero item added');
            }

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) { pushHero(e.target.result); };
                reader.readAsDataURL(file);
            } else {
                pushHero('');
            }
        }

        // Inline hero drop zone
        const inlineDrop = document.getElementById('inlineHeroDropZone');
        if (inlineDrop) {
            inlineDrop.addEventListener('dragover', function(e){ e.preventDefault(); this.style.borderColor = 'var(--gold)'; });
            inlineDrop.addEventListener('dragleave', function(e){ this.style.borderColor = '#333'; });
            inlineDrop.addEventListener('drop', function(e){
                e.preventDefault(); this.style.borderColor = '#333';
                const f = e.dataTransfer.files && e.dataTransfer.files[0];
                if (f) {
                    document.getElementById('inlineHeroImageFile').files = e.dataTransfer.files;
                    this.innerText = f.name;
                    const reader = new FileReader();
                    reader.onload = function(ev) { document.getElementById('inlineHeroPreview').innerHTML = `<img src="${ev.target.result}" style="max-width:100%; max-height:100%; display:block;"/>`; };
                    reader.readAsDataURL(f);
                }
            });
        }

        // file input preview for inline hero
        const inlineFileEl = document.getElementById('inlineHeroImageFile');
        if (inlineFileEl) inlineFileEl.addEventListener('change', function(){
            const f = this.files && this.files[0];
            const zone = document.getElementById('inlineHeroDropZone');
            const prev = document.getElementById('inlineHeroPreview');
            if (f) {
                zone.innerText = f.name;
                const reader = new FileReader();
                reader.onload = function(ev){ if (prev) prev.innerHTML = `<img src="${ev.target.result}" style="max-width:100%; max-height:100%; display:block;"/>`; };
                reader.readAsDataURL(f);
            } else {
                zone.innerText = 'Drag & drop an image here or use the file input';
                if (prev) prev.innerHTML = '';
            }
        });
    </script>
</body>
</html>
