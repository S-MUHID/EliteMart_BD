<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EliteMart BD - My Orders</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .orders-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .orders-header h1 {
            color: var(--gold);
            margin: 0;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: #0f0f0f;
            border: 2px solid #222;
            color: var(--muted);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .order-card {
            background: var(--card);
            border: 1px solid #222;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .order-card:hover {
            border-color: var(--gold);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            border-bottom: 1px solid #222;
            padding-bottom: 15px;
        }

        .order-id-date {
            flex: 1;
        }

        .order-id {
            color: var(--gold);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .order-date {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .order-status {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-pending {
            background: #3d3d0b;
            color: #ffff99;
        }

        .status-confirmed {
            background: #0b3d0b;
            color: #adffad;
        }

        .status-shipped {
            background: #0b2d3d;
            color: #99ddff;
        }

        .status-delivered {
            background: #0b3d0b;
            color: #adffad;
        }

        .status-cancelled {
            background: #3d0b0b;
            color: #ff9999;
        }

        .order-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .detail-section h3 {
            color: var(--gold);
            margin: 0 0 10px 0;
            font-size: 0.95rem;
        }

        .detail-text {
            color: var(--muted);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .order-items {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .order-items h3 {
            color: var(--gold);
            margin: 0 0 15px 0;
            font-size: 0.95rem;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
            font-size: 0.9rem;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-name {
            color: #fff;
            flex: 1;
        }

        .item-qty {
            color: var(--muted);
            margin: 0 15px;
        }

        .item-price {
            color: var(--gold);
            font-weight: 700;
            text-align: right;
        }

        .order-total {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            margin-bottom: 15px;
        }

        .total-amount {
            color: var(--gold);
            font-size: 1.3rem;
            font-weight: 700;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 15px;
            background: var(--gold);
            color: #000;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #e8c355;
        }

        .action-btn.secondary {
            background: #0f0f0f;
            color: var(--gold);
            border: 1px solid #222;
        }

        .action-btn.secondary:hover {
            border-color: var(--gold);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state h2 {
            color: var(--gold);
            margin-bottom: 15px;
        }

        .empty-state p {
            color: var(--muted);
            margin-bottom: 20px;
        }

        .tracking-timeline {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-dot {
            width: 20px;
            height: 20px;
            background: var(--gold);
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .timeline-dot.inactive {
            background: #444;
        }

        .timeline-content {
            flex: 1;
            padding-bottom: 15px;
        }

        .timeline-title {
            color: #fff;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .timeline-time {
            color: var(--muted);
            font-size: 0.85rem;
        }

        @media (max-width: 900px) {
            .order-details {
                grid-template-columns: 1fr;
            }

            .filter-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Access Check Script -->
    <script>
        const isLoggedIn = sessionStorage.getItem('customerLoggedIn') === 'true';
        if (!isLoggedIn) {
            document.body.innerHTML = '';
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #0b0b0b, #000); display: flex; align-items: center; justify-content: center; z-index: 9999;';
            overlay.innerHTML = `
                <div style="background: linear-gradient(135deg, #0f0f0f, #0a0a0a); border: 2px solid #333; border-radius: 14px; padding: 50px; max-width: 500px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(217, 178, 74, 0.3);">
                    <h2 style="color: #d9b24a; font-size: 1.8rem; margin: 0 0 10px 0; text-shadow: 0 0 10px rgba(217, 178, 74, 0.3);">ðŸ“‹ My Orders</h2>
                    <p style="color: #bdbdbd; margin: 20px 0; font-size: 1rem; line-height: 1.6;">You must be logged in to view your order history and track your purchases.</p>
                    <div style="background: rgba(217, 178, 74, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #d9b24a; margin: 20px 0;">
                        <p style="color: #fff; margin: 0; font-weight: 600;">ðŸ”’ Login required to see orders</p>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 30px;">
                        <button onclick="location.href='customer-login.html'" style="flex: 1; padding: 12px; background: #d9b24a; color: #000; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s;">Login Now</button>
                        <button onclick="location.href='customer-signup.html'" style="flex: 1; padding: 12px; background: #333; color: #fff; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">Create Account</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            throw new Error('Access restricted');
        }
    </script>

    <header>
        <a href="index.html" class="logo">
            <div class="mark">EM</div>
            <div>
                <h1>EliteMart BD</h1>
                <div style="color:var(--muted);font-size:0.9rem">Style that Speaks, Quality that Lasts</div>
            </div>
        </a>

        <div class="searchbar">
            <input placeholder="Search for products..." />
            <button class="searchbtn" onclick="search()">Search</button>
        </div>

        <div class="toplinks">

            <a class="badge" href="cart.html" style="position: relative;">
                ðŸ›’ Cart
                <span class="cart-count" style="display: none;">0</span>
            </a>
        </div>
    </header>

    <div class="orders-container">
        <div class="orders-header">
            <h1>My Orders</h1>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterOrders('all')">All Orders</button>
                <button class="filter-btn" onclick="filterOrders('pending')">Pending</button>
                <button class="filter-btn" onclick="filterOrders('confirmed')">Confirmed</button>
                <button class="filter-btn" onclick="filterOrders('delivered')">Delivered</button>
            </div>
        </div>

        <div id="ordersContainer"></div>
    </div>

    <footer>
        Â© 2025 EliteMart BD â€¢ Trusted Fashion & Lifestyle â€¢ Cash on Delivery Available Nationwide
    </footer>

    <script src="script.js"></script>
    <script>
        let currentFilter = 'all';

        function getOrders() {
            return JSON.parse(localStorage.getItem('orders')) || [];
        }

        function renderOrders(status = 'all') {
            const orders = getOrders();
            const container = document.getElementById('ordersContainer');

            let filtered = orders;
            if (status !== 'all') {
                filtered = orders.filter(o => o.status.toLowerCase() === status);
            }

            // Sort by date - newest first
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>No Orders Found</h2>
                        <p>You haven't placed any orders yet.</p>
                        <a href="index.html" class="cta">Continue Shopping</a>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-id-date">
                            <div class="order-id">${order.id}</div>
                            <div class="order-date">${order.date} at ${order.time}</div>
                        </div>
                        <div class="order-status status-${order.status.toLowerCase()}">${order.status}</div>
                    </div>

                    <div class="order-details">
                        <div class="detail-section">
                            <h3>ðŸ‘¤ Shipping To</h3>
                            <div class="detail-text">
                                ${order.customer.firstName} ${order.customer.lastName}<br>
                                ${order.customer.address}<br>
                                ${order.customer.city}, ${order.customer.postalCode}<br>
                                ${order.customer.phone}
                            </div>
                        </div>
                        <div class="detail-section">
                            <h3>ðŸ’³ Payment Method</h3>
                            <div class="detail-text">
                                ${getPaymentMethodLabel(order.payment)}<br><br>
                                <strong style="color: var(--gold);">Items: ${order.items.length}</strong>
                            </div>
                        </div>
                    </div>

                    <div class="order-items">
                        <h3>ðŸ“¦ Items</h3>
                        ${order.items.map(item => `
                            <div class="item-row">
                                <span class="item-name">${item.name}</span>
                                <span class="item-qty">Ã—${item.quantity}</span>
                                <span class="item-price">à§³${(item.price * item.quantity).toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div class="order-total">
                        <div class="total-amount">Total: à§³${order.total.toLocaleString()}</div>
                    </div>

                    ${order.status === 'Pending' ? `
                        <div class="tracking-timeline">
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Order Placed</div>
                                    <div class="timeline-time">${order.date}</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot inactive"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Payment Confirmed</div>
                                    <div class="timeline-time">Awaiting confirmation...</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot inactive"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Shipped</div>
                                    <div class="timeline-time">In progress</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot inactive"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Delivered</div>
                                    <div class="timeline-time">Pending</div>
                                </div>
                            </div>
                        </div>
                        <div class="order-actions" style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="alert('We will contact you soon for payment confirmation.')">Get Updates</button>
                            <button class="action-btn secondary" onclick="cancelOrder('${order.id}')">Cancel Order</button>
                        </div>
                    ` : `
                        <div class="tracking-timeline">
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Order Placed</div>
                                    <div class="timeline-time">${order.date}</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot ${order.status !== 'Pending' ? '' : 'inactive'}"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Payment Confirmed</div>
                                    <div class="timeline-time">${order.date}</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot ${['Shipped', 'Delivered'].includes(order.status) ? '' : 'inactive'}"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Shipped</div>
                                    <div class="timeline-time">${order.status === 'Delivered' || order.status === 'Shipped' ? order.date : 'In progress'}</div>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot ${order.status === 'Delivered' ? '' : 'inactive'}"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Delivered</div>
                                    <div class="timeline-time">${order.status === 'Delivered' ? order.date : 'Pending'}</div>
                                </div>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="action-btn" onclick="reorderItems('${order.id}')">Reorder</button>
                            <button class="action-btn secondary" onclick="alert('Contact us at support@elitemart.bd for returns.')">Return Items</button>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function getPaymentMethodLabel(method) {
            const methods = {
                'cod': 'ðŸ’µ Cash on Delivery',
                'bkash': 'ðŸ”µ bKash',
                'nagad': 'ðŸŸ  Nagad',
                'card': 'ðŸ’³ Credit/Debit Card'
            };
            return methods[method] || method;
        }

        function filterOrders(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOrders(status);
        }

        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                const orders = getOrders();
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'Cancelled';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    renderOrders(currentFilter);
                    alert('Order cancelled successfully.');
                }
            }
        }

        function reorderItems(orderId) {
            const orders = getOrders();
            const order = orders.find(o => o.id === orderId);
            if (order) {
                cart = JSON.parse(JSON.stringify(order.items));
                saveCart();
                updateCartCount();
                location.href = 'cart.html';
            }
        }

        // Check for specific order ID in URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('id');

        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            renderOrders(currentFilter);
            if (orderId) {
                const element = document.querySelector(`[data-order-id="${orderId}"]`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
    </script>
</body>
</html>
